import java.rmi.RemoteException;
import java.rmi.server.UnicastRemoteObject;
import java.util.Arrays;

public class ProcessImpl extends UnicastRemoteObject implements Process {
    private int[] vectorClock;
    private int processId;
    private BSSManager bssManager;

    public ProcessImpl(int processId, int numProcesses, BSSManager bssManager) throws RemoteException {
        this.processId = processId;
        this.bssManager = bssManager;
        vectorClock = new int[numProcesses];
        Arrays.fill(vectorClock, 0);
        bssManager.registerProcess(this);
    }

    @Override
    public void sendMessage(String message) throws RemoteException {
        vectorClock[processId]++;
        bssManager.sendMessage(processId, message, vectorClock);
    }

    @Override
    public void deliverMessage(int senderId, String message, int[] senderClock) throws RemoteException {
        // Update the local vector clock based on the sender's clock
        for (int i = 0; i < vectorClock.length; i++) {
            vectorClock[i] = Math.max(vectorClock[i], senderClock[i]);
        }
        // Increment the local clock for this delivery
        vectorClock[processId]++;
        System.out.println("Process " + processId + " delivered message: " + message);
    }

    @Override
    public int[] getVectorClock() throws RemoteException {
        return vectorClock;
    }
}
