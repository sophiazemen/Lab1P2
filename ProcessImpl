import java.rmi.RemoteException;
import java.rmi.server.UnicastRemoteObject;
import java.util.Arrays;

public class ProcessImpl extends UnicastRemoteObject implements Process {
    private int[] vectorClock;
    private int processId;
    private BSSManager bssManager;

    public ProcessImpl(int processId, int numProcesses, BSSManager bssManager) throws RemoteException {
        this.processId = processId;
        this.bssManager = bssManager;
        vectorClock = new int[numProcesses];
        Arrays.fill(vectorClock, 0);

        bssManager.registerProcess(this); // Register this process with BSSManager
    }

    @Override
    public void sendMessage(String message) throws RemoteException {
        vectorClock[processId]++;
        bssManager.sendMessage(processId, message, vectorClock);
    }

    @Override
    public void deliverMessage(int senderId, String message, int[] vectorClock) throws RemoteException {
        System.out.println("Process " + processId + " delivered message: " + message + " from Process " + senderId);
    }

    @Override
    public int[] getVectorClock() throws RemoteException {
        return vectorClock;
    }
}
